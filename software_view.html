---
layout: default
---

<div class="home">

  <h1 class="page-heading">Software</h1>

  <div id="dc-languages-chart"></div>

  <div id="dc-discipline-chart"></div>

  <div class='row-fluid'>
    <div class='span12 table-graph'>
        <h4>Software Projects</h4>
        <table class='table table-hover dc-data-table' id='dc-table-graph'>
            <thead>
                <tr class='header'>
                    <th>Name</th>
                    <th>Tag Line</th>
                </tr>
            </thead>
        </table>
    </div>
  </div>

</div>

<script type="text/javascript">
d3.json("software_test.json", function (software_data) {
	var dataTable = dc.dataTable("#dc-table-graph");
	var languageChart = dc.rowChart("#dc-languages-chart");
	var disciplineChart = dc.rowChart("#dc-discipline-chart");
	var ndx = crossfilter(software_data);
	var softwareDimension = ndx.dimension(function (d) { return d['@id']; });
	var programmingLanguageDimension =  ndx.dimension(function (d) { return d['programmingLanguage']; });
	var disciplineDimension = ndx.dimension(function(d) { return d.discipline; });

	var programmingLanguageCount = programmingLanguageDimension.group().reduceCount();


	languageChart.width(400).height(400)
		.dimension(programmingLanguageDimension)
		.group(programmingLanguageCount)
		.elasticX(true);

	dataTable.width(800).height(800)
    	.dimension(softwareDimension)
    	.group(function(d) { return "List of all Selected Software Projects"
    	})
    .size(100)
    .columns([
        function(d) { return d.name; },
        function(d) { return d.tagLine; }
    ])
    .sortBy(function(d){ return d.name; })
    // (optional) sort order, :default ascending
    .order(d3.ascending);

      function reduceFieldsAdd(fields) {
        return function(p, v) {
          var disciplines = v.discipline;

          fields.forEach(function(f) {
            if (disciplines.indexOf(f) > -1) {
              p[f] += 1;
            }
          });
          return p;
        };
      }
      function reduceFieldsRemove(fields) {
        return function(p, v) {
          var disciplines = v.discipline;

          fields.forEach(function(f) {
            if (disciplines.indexOf(f) > -1) {
              p[f] -= 1;
            }
          });
          return p;
        };
      }
      function reduceFieldsInitial(fields) {
        return function() {
          var ret = {};
          fields.forEach(function(f) {
            ret[f] = 0;
          });
          return ret;
        };
      }
      var disciplineValues = ["Physics & Beyond", "Environment & Sustainability", "Life Sciences & eHealth", "Humanities & Social Sciences", "eScience Methodology"];
      var disciplineGroup = disciplineDimension.groupAll().reduce(reduceFieldsAdd(disciplineValues), reduceFieldsRemove(disciplineValues), reduceFieldsInitial(disciplineValues));


      var fakeDisciplineGroup = {
        all: function() {
          var hash = disciplineGroup.value();
          var result = [];
          for (var kv in hash) {
            result.push({
              key: kv,
              value: hash[kv]
            });
          }
          return result;
        }
      };

      disciplineChart
        .width(200)
        .height(200)
        .dimension(disciplineDimension)
        .group(fakeDisciplineGroup)
        .filterHandler(function(dimension, filter){
          dimension.filterFunction(function(d) {
            var result = true;
            filter.forEach(function(f) {
              if (result === true && d.indexOf(f) === -1) {
                result = false;
              }
            });
            return result;
          });
          // dimension.filter(filter);
          return filter; // set the actual filter value to the new value
        }) 
        .elasticX(true);


	dc.renderAll();
});
</script>