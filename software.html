---
layout: page
title: software
---

<div class="home">

  <div id="dc-languages-chart"></div>

  <div id="dc-discipline-chart"></div>

  <table class='table table-hover dc-data-table' id='dc-table-graph'>
      <thead>
          <tr class='header'>
              <th>Name</th>
              <th>Tag Line</th>
          </tr>
      </thead>
  </table>

</div>

<script type="text/javascript">
d3.json("/software.json", function (software_data) {
  var disciplineFilter = purl().fparam('discipline');
  var programmingLanguageFilter = purl().fparam('programmingLanguage');

	var dataTable = dc.dataTable("#dc-table-graph");
	var languageChart = dc.rowChart("#dc-languages-chart");
	var disciplineChart = dc.rowChart("#dc-discipline-chart");
	var ndx = crossfilter(software_data);
	var softwareDimension = ndx.dimension(function (d) { return d['@id']; });
	var programmingLanguageDimension =  ndx.dimension(function (d) { return d['programmingLanguage']; });
	var disciplineDimension = ndx.dimension(function(d) { return d.discipline; });

	var programmingLanguageCount = programmingLanguageDimension.group().reduceCount();

      function reduceFieldsAdd(fields) {
        return function(p, v) {
          var disciplines = v.discipline;

          fields.forEach(function(f) {
            if (disciplines.indexOf(f) > -1) {
              p[f] += 1;
            }
          });
          return p;
        };
      }
      function reduceFieldsRemove(fields) {
        return function(p, v) {
          var disciplines = v.discipline;

          fields.forEach(function(f) {
            if (disciplines.indexOf(f) > -1) {
              p[f] -= 1;
            }
          });
          return p;
        };
      }
      function reduceFieldsInitial(fields) {
        return function() {
          var ret = {};
          fields.forEach(function(f) {
            ret[f] = 0;
          });
          return ret;
        };
      }
      var disciplineValues = ["Physics & Beyond", "Environment & Sustainability", "Life Sciences & eHealth", "Humanities & Social Sciences", "eScience Methodology"];
      var disciplineGroup = disciplineDimension.groupAll().reduce(reduceFieldsAdd(disciplineValues), reduceFieldsRemove(disciplineValues), reduceFieldsInitial(disciplineValues));


      var fakeDisciplineGroup = {
        all: function() {
          var hash = disciplineGroup.value();
          var result = [];
          for (var kv in hash) {
            result.push({
              key: kv,
              value: hash[kv]
            });
          }
          return result;
        }
      };

	var programmingLanguageCount = programmingLanguageDimension.group().reduceCount();


	languageChart.width(340).height(340)
		.dimension(programmingLanguageDimension)
		.group(programmingLanguageCount)
		.elasticX(true)
        .colors(d3.scale.category20());
  if (programmingLanguageFilter) {
    languageChart.filter(programmingLanguageFilter);
  }

  disciplineChart
    .width(340)
    .height(340)
    .dimension(disciplineDimension)
    .group(fakeDisciplineGroup)
    .filterHandler(function(dimension, filter){
      dimension.filterFunction(function(d) {
        var result = true;
        filter.forEach(function(f) {
          if (result === true && d.indexOf(f) === -1) {
            result = false;
          }
        });
        return result;
      });
      // dimension.filter(filter);
      return filter; // set the actual filter value to the new value
    })
    .elasticX(true)
    .colors(d3.scale.category20());
  if (disciplineFilter) {
    disciplineChart.filter(disciplineFilter);
  }

  dataTable.width(800).height(800)
      .dimension(softwareDimension)
      .group(function(d) { return d.competence[0]; })
    .size(100)
    .columns([
        function(d) { return '<a href="' + d['@id'].replace('http://estep.esciencecenter.nl', '') + '">' + d.name + '</a>'; },
        function(d) { return d.tagLine; }
    ])
    .sortBy(function(d){ return d.name; })
    // (optional) sort order, :default ascending
    .order(d3.ascending);


	dc.renderAll();
});
</script>
